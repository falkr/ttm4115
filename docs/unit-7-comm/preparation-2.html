<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="generator" content="">
  <title>TTM4115</title>
  <link rel="canonical" href="https://edu.iik.ntnu.no">
  <!-- Bootstrap core CSS -->
  <link href="../assets/bootstrap.min.css" rel="stylesheet">
  <!-- Custom styles for this template -->
  <link href="../assets/style.css" rel="stylesheet">
  <link rel="stylesheet" href="../assets/bootstrap-icons.css">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="../assets/anchor.js"></script>
  <script src="../assets/script-aside.js"></script>
  <style type="text/css">
    a.ntnu-button {
    font: 600 14px "Source Sans Pro", Georgia, serif;
    background: #fff;
    color: #00509e;
    border: 1px solid #00509e;
    border-color: #00509e !important;
    border-style: solid !important;
    border-radius: 10rem;
    display: inline-block;
    padding: 5px 15px;
    height: auto;
    font-weight: bold;
    line-height: 1.5em;
    text-align: center;
    vertical-align: top;
    cursor: pointer;
    text-decoration: none
}

a.ntnu-button:hover {
    background: #00509e;
    color: #fff;
    text-decoration: none
}
.person-card img {
  width: 56px;
  border: 1px solid #eee;
}

.person-card-name {
  font-weight: 600;
}

.person-card-email {
  font-size: 0.8em;
}

.person-card-detail {
  font-size: 0.8em;
}
div.check ul,
div.check ul li {
  padding: 0;
  margin: 0;
  list-style: none;
}

div.check ul {
  margin: 2em 0;
}

div.check ul li {
  margin: 1em;
  margin-left: 3em;
}

div.check ul li:before {
  content: '\f26a';
  font-family: bootstrap-icons !important;
  font-size:20;
  float: left;
  margin-left: -1.5em;
  color: #1481b8;
}
div.delivery p {
  padding: 10px;
  background-color: #ffd9ab;
  font-family: "Source Sans Pro", Georgia, serif;
  border-radius: 5px;
  border-left: 6px solid #fc8c03; 
}
  
div.delivery p::before {
  content: 'Delivery: ';
  font-family: "Source Sans Pro", Georgia, serif;
  color: #fc8c03;
  display: inline;
  font-weight: bold;
}
div.figure {
  padding: 20px 0 20px 0;
  width: 100%;
}

div.figurefullwitdth {
  padding: 20px 0 20px 0;
  margin-left: -33px;
  margin-right: -33px;
  width: 100%;
}
div.goals ul,
div.goals ul li {
  padding: 0;
  margin: 0;
  list-style: none;
}

div.goals ul {
  margin: 2em 0;
}

div.goals ul li {
  margin: 1em;
  margin-left: 3em;
}

div.goals ul li:before {
  content: '\f26a';
  font-family: bootstrap-icons !important;
  font-size: 20;
  float: left;
  margin-left: -1.5em;
  color: #00509e;
}
.w3collapsible {
  background-color:#f0e9db;
  color: #868279; 
  padding: 8px 18px 8px 8px;
  cursor: pointer;
  width: 100%;
  border: none;
  border-radius: 3px 3px 0 0;
  text-align: left;
  outline: none;
  font-size: 15px;
}

.w3active, .w3collapsible:hover {
  background-color: #f0e9cb;
}

.w3content {
  filter: blur(3px);
  padding: 0 18px;
  display: block;
  overflow: hidden;
  background-color: #f3f3f3;
  margin-bottom: 15px;
}


button:hover {
  background-color: #EFF7FF;
}
div.qna .accordion-button:not(.collapsed) {
  background-color: #EFF7FF;
  box-shadow: inset 0 -1px 0 rgba(0,0,0,.125);
  color: #00509e;
}

div.qna .accordion-button:not(.collapsed)::after {
  color: #00509e;
}
/*tr.rubric_title {background-color: lightgrey}*/
/*tr.rubric_a {background-color: #D0E8DC}
tr.rubric_b {background-color: #EEF7DB}
tr.rubric_c {background-color: #FCFDE3}
tr.rubric_d {background-color: #FDF3D6}
tr.rubric_e {background-color: #F8D9C2}
tr.rubric_f {background-color: #EBBCB9}

tr.rubric_title {background-color: white; 
	border-top: 2px black solid; 
	border-bottom: 2px black solid;}
td.rubric_title {background-color: white;}
td.rubric_a {background-color: #D0E8DC}
td.rubric_b {background-color: #EEF7DB}
td.rubric_c {background-color: #FCFDE3}
td.rubric_d {background-color: #FDF3D6}
td.rubric_e {background-color: #F8D9C2}
td.rubric_f {background-color: #EBBCB9}

th.rubric_title {background-color: white}
th.rubric_a {background-color: #D0E8DC}
th.rubric_b {background-color: #EEF7DB}
th.rubric_c {background-color: #FCFDE3}
th.rubric_d {background-color: #FDF3D6}
th.rubric_e {background-color: #F8D9C2}
th.rubric_f {background-color: #EBBCB9}

table.rubric th {border-top: 2px black solid; border-bottom: 2px black solid; text-align: center;
	vertical-align:top;}
table.rubric td {width:22%; border-bottom: 1px black solid;}}*/

.rubric p {
	margin: 0px
}

.rubric th {
	text-align: center;
	padding: 6px;
}

.rubric td {
	vertical-align: top;
	font-size: 12px;
	padding: 6px;
}

.rubric th {
	font-size: 12px;
	vertical-align: top;
}

.rubric td:nth-child(2),
.rubric th:nth-child(2) {
	background-color: #D0E8DC;
	width: 22%
}

.rubric td:nth-child(3),
.rubric th:nth-child(3) {
	background-color: #FCFDE3;
	width: 22%
}

.rubric td:nth-child(4),
.rubric th:nth-child(4) {
	background-color: #F8D9C2;
	width: 22%
}

.rubric td:nth-child(5),
.rubric th:nth-child(5) {
	background-color: #EBBCB9;
	width: 22%
}

.rubric tfoot td {
	text-align: right;
	border-bottom: none;
	padding: 1px;
}

.rubric tfoot a {
	font-size: 12px;
	font-style: italic;
	color: gray
}

div.tip p {
  padding: 10px;
  background-color: #d9eaf2;
  border-radius: 5px;
  border-left: 6px solid #1481b8
}

table.weekplan {
  width: 100%;
  table-layout: fixed;
}

table.weekplan td {
  background-color: #1481b8;
  color: white;
}

table.weekplan td, table.weekplan th {
  text-align: center;
}

table.weekplan td:empty {
  background-color: white;
}

table.weekplan td:first-child {
  background-color: white;
  color: grey;
}

table.weekplan a {
  font-weight:bold;
  color: white;
  text-decoration: underline;
}

  </style>
</head>

<body>
  
  



<nav class="navbar navbar-expand-lg navbar shadow-sm">
  <div class="container-fluid">
    <a class="navbar-brand" href="https://ntnu.edu" title="NTNU Homepage">
      <img id="header_logo" alt="NTNU Hjemmeside" width="120px" src="https://www.ntnu.no/o/ntnu-theme/images/logo_ntnu.svg" height="23px">
    </a>
    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="../index.html">TTM4115</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Units
          </a>
          <ul class="dropdown-menu dropdown-menu">
            <a class="dropdown-item" href="../unit-1-setup/index.html">Unit 1: Introduction and Setup</a>
            <a class="dropdown-item" href="../unit-2-models/index.html">Unit 2: Modeling and Deployment Diagrams</a>
            <a class="dropdown-item" href="../unit-3-stm/index.html">Unit 3: State Machines</a>
            <a class="dropdown-item" href="../unit-4-req/index.html">Unit 4: User Requirements</a>
            <a class="dropdown-item" href="../unit-5-stmpy/index.html">Unit 5: State Machines in Python</a>
            <a class="dropdown-item" href="../unit-6-agile/index.html">Unit 6: Agile Development</a>
            <a class="dropdown-item" href="../unit-7-comm/index.html">Unit 7: Communication</a>
            <a class="dropdown-item" href="../unit-8-sd/index.html">Unit 8: Interactions</a>
            <a class="dropdown-item" href="../unit-9-comp/index.html">Unit 9: Components</a>
          </ul>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Project
          </a>
          <ul class="dropdown-menu dropdown-menu">
            <a class="dropdown-item" href="../project/index.html">Semester Project</a>
            <a class="dropdown-item" href="../project/deliveries-t1.html">Specification 1</a>
            <a class="dropdown-item" href="../project/deliveries-i1.html">Feedback on Specification 1</a>
            <a class="dropdown-item" href="../project/deliveries-t2.html">Specification 2</a>
            <a class="dropdown-item" href="../project/deliveries-i2.html">Feedback on Specification 2</a>
            <a class="dropdown-item" href="../project/deliveries-t3.html">Specification 3 (Final)</a>
            <a class="dropdown-item" href="../project/deliveries-i3.html">Feedback on Specification 3</a>
            
          </ul>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Learning
          </a>
          <ul class="dropdown-menu dropdown-menu">
            <a class="dropdown-item" href="../learning/feedback.html">Feedback</a>
            <a class="dropdown-item" href="../learning/goals.html">Learning Goals</a>
            <a class="dropdown-item" href="../learning/grading.html">Grading</a>
            <a class="dropdown-item" href="../learning/reflection.html">Reflection</a>
            <a class="dropdown-item" href="../learning/tbl.html">Team-Based Learning</a>
            <a class="dropdown-item" href="../learning/teamwork.html">Teamwork</a>
            <a class="dropdown-item" href="../schedule.html">Schedule</a>
          </ul>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Tools
          </a>
          <ul class="dropdown-menu dropdown-menu">
            <a class="dropdown-item" href="../tools/index.html">Tools</a>
            <!--<a class="dropdown-item" href="../tools/tools-python.html">Python</a>-->
            <a class="dropdown-item" href="../tools/tools-gui.html">GUIs in Python</a>    
            <a class="dropdown-item" href="../tools/tools-mqtt.html">MQTT</a>            
            <a class="dropdown-item" href="../tools/tools-notebooks.html">Notebooks</a>
            <a class="dropdown-item" href="../tools/tools-stmpy.html">STMPY</a>            
          </ul>
        </li>
      </ul>
      <div class="bg-light border ms-auto"></div>
        <div>
        <a class="nav-link" href="../schedule.html"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar3" viewBox="0 0 16 16">
          <path d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857V3.857z"/>
          <path d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
        </svg></a>
      </div>
    </div>
  </div>
</nav>






  <main class="container">

    <div class="row g-5 justify-content-md-center pb-5">



      <div class="col-md-9" style="margin-top: 6rem;">
        <div class="page">
<nav style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E&#34;);" aria-label="breadcrumb">
<ol class="breadcrumb">
<li class="breadcrumb-item"><a href="../index.html">TTM4115</a></li>
<li class="breadcrumb-item"><a href="index.html">Unit 7: Communication</a></li>
<li class="breadcrumb-item active" aria-current="page">HTTP - Hypertext Transfer Protocol</li>
</ol>
</nav>
    </section>
    <section class="content">
<h1>HTTP - Hypertext Transfer Protocol</h1>
<p>This is only a very brief description of HTTP to relate it to the
previously described communication topologies and message patterns. You
have probably already heard about HTTP in other courses. Here, we look
at it from an application's perspective. If you are interested in more
technical details, read for instance on <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">Wikipedia</a>.</p>
<p>HTTP is a request-response message pattern, and uses a client-server
topology. The server usually provides resources to the client, which can
be a web browser. In HTTP, the initiatives for communication are
uni-directional. This means, the client takes initiative and contacts
the server, not the other way round. For the original purpose of HTTP
(requesting documents from a server) this is suitable characteristic,
since it simplifies the construction of efficient servers and how
documents can be cached.</p>
<h2>Getting Bi-Directional  {#getting-bi-directional .unnumbered}</h2>
<p>One websites should get more interactive, this is a limitation we are
all aware of. We are used to refresh a website to see if there is new
information available. And when booking a flight or paying via credit
card, you see clumsy messages like &quot;Don't reload this page.&quot; This is so
inelegant because technology was never intended to this stuff with a
browser! With this example you also see which fundamental effect
communication topologies and message patterns have. Websites today are
incredibly more advanced than ten years ago. Still, some of these old
limitations are hard to get rid off.</p>
<p>There are some mechanisms that work around these limitations of HTTP. If
you are interested in the details, have a look at the <a href="https://en.wikipedia.org/wiki/Comet_(programming)">Wikipedia article
on Comet</a>. To keep it brief; it's fascinating, but ugly. In essence,
the workaround is that the client still initiates all communication, but
client and server keep an HTTP connection alive, so that the server can
send updates once there are some. When Google offered chat on their
Gmail website, for instance, they used this mechanism to <a href="https://stackoverflow.com/questions/732705/how-is-gmail-chat-able-to-make-ajax-requests-without-client-interaction">push new chat
messages immediately from the server to the browser</a>. Google Docs
uses a <a href="https://stackoverflow.com/questions/35070217/what-technology-does-google-drive-use-to-get-real-time-updates">similar mechanism</a>.</p>
<p>To address the needs of server to notify the client when new information
is available, the <a href="https://en.wikipedia.org/wiki/WebSocket">WebSocket protocol</a> was built. Like HTTP, it also
builds upon TCP, but offers full-duplex. With WebSockets, you can for
instance build relatively simple web-applications running in the browser
that support fine-grained, bi-directional interactions like chat or
games.</p>

    </section>
    <section class="content">
<h1>MQTT</h1>
<p>MQTT is a protocol that is based on the <strong>broker</strong> topology, and that
implements a <strong>publish-subscribe</strong> message pattern. MQTT was invented in
1999 by Andy Stanford-Clark from IBM and Arlen Nipper from Arcom. Today,
MQTT is an Oasis standard.</p>

<span name="b32115"></span><aside name="b32115"><p>Read the article <a href="https://www.facebook.com/notes/facebook-engineering/building-facebook-messenger/10150259350998920">Building Facebook Messenger</a></p>
</aside>
<p>MQTT is often used in situations where events should be sent from many
sensors and broadcast to several applications. IBM and others for
instance use MQTT so that IoT devices can send updates into their cloud.
When Facebook introduced their Messenger application as a standalone
application, they also relied on MQTT to push messages to the
clients. We consider MQTT in detail because this protocol is
relatively easy to understand, introduces concepts that are used in
various form also in other protocols, and because its patterns and
topology is complementary to those of HTTP. When you have understood
MQTT and HTTP, many other application-level protocols will be easy to
understand, too. There are also some more practical reasons why we
recommend you to use MQTT for the semester project:</p>

<ul>
<li>
<p>MQTT is simple to debug, since more than one entity can subscribe to
the same topic. This means, you can work on the communication
between two entities, but observe all communication by subscribing
to these topics with a debugging tool.</p>
</li>
<li>
<p>You only need to handle the IP address of the MQTT broker. All other
addressing happens indirectly via topics.</p>
</li>
<li>
<p>Application startup is simple. You can startup the MQTT broker
first, but clients can then connect in any order after that. The
MQTT broker can also be hosted on a server and be always-on.</p>
</li>
<li>
<p>MQTT works also behind a NAT, in both directions. This means you can
push a message from any location to a computer that is connected to
your router at home.</p>
</li>
</ul>
<h2>Roles</h2>
<p>There are three roles in MQTT. The <strong>Publisher</strong> sends messages to the
<strong>Broker</strong>, which then forwards them to a set of interested
<strong>Subscribers</strong>.</p>
<p>A typical interaction looks as follows:</p>

<div class="figure">
<img src="../../pages/unit-7-comm/figures/mqtt-1.svg" width="100%"/>
</div>
<p>There can be any number of subscribers and any number of publishers in a
system. Because of the publish-subscribe pattern, the subscribers do not
have to know about the publishers, and the publishers do not have to
know of the subscribers. They only have to know the address of the MQTT
broker and connect to it.</p>
<p>The brokers only implement generic functionality, this means, they do
not depend on the specific application. Therefore, the broker is a
component in a system that can be reused. There are several MQTT brokers
available. Examples are Mosquitto, RSMB, HiveMQ.</p>
<h2>Topics</h2>
<p>Usually, subscribers are not interested in all messages that all
publishers send. Subscribers therefore only subscribe to specific
topics, which depend on the application. The topics are organized in a
hierarchy, separated by a dash (&quot;/&quot;). The following is an example for
topics that an application for home automation can use:</p>

<pre><code>house/garage/lights/l1
house/garage/lights/l2
house/garage/sensors/pi1
house/garage/doors/d1</code></pre>
<p>The light <em>l1</em> for instance subscribes to the topic
<code>house/garage/lights/l1</code> so that it can receive messages that switch it
on or off. The passive infrared sensor <em>pi1</em> publishes messages to the
topic <code>house/garage/sensors/pi1</code> every time it detects a movement. An
application to switch on the lights whenever a movement is detected can
then work like this: (In pseudo code)</p>

<pre><code>subscribe to house/garage/sensors/pi1
whenever an MQTT messages arrives at house/garage/sensors/pi1:
    send a message 
        to house/garage/lights/l1 with payload &quot;on&quot;@
    
    after some time, send a message
        to house/garage/lights/l1 with payload &quot;off&quot;</code></pre>
<p>Topics can include wildcards, which make it possible for a subscriber to
subscribe to several topics with a single pattern:</p>
<ul>
<li>
<p>The &quot;+&quot; is used as a wildcard for a single level</p>
</li>
<li>
<p>The &quot;#&quot; is used as a wildcard for several levels. It must only be
placed at the end of a topic pattern.</p>
</li>
</ul>
<p>Examples:</p>
<ul>
<li>
<p>To receive all messages sent within the house, a subscriber can
subscribe to <code>house/#</code></p>
</li>
<li>
<p>To receive all messages for lights in any zone (garage or kitchen),
a subscriber can subscribe to <code>house/+/lights/+</code></p>
</li>
</ul>
<h3>Exercise:</h3>
<p>A publisher sends a message to the topic <code>a/b/c/d</code>. Which of the
following 15 subscription topics will receive this message?</p>
<pre><code>   **Subscription Topic**  
</code></pre>
<hr />
<p>1    <code>#</code><br />
2    <code>+/+/+</code><br />
3    <code>+/+/+/+</code><br />
4    <code>+/b/c/#</code><br />
5    <code>+/b/c/d</code><br />
6    <code>a/#</code><br />
7    <code>a/+/+/d</code><br />
8    <code>a/+/c/d</code><br />
9    <code>a/b/#</code><br />
10   <code>a/b/c</code><br />
11   <code>a/b/c/#</code><br />
12   <code>a/b/c/d/#</code><br />
13   <code>a/b/c/d</code><br />
14   <code>b/+/c/d</code><br />
15   <code>a/b/c/d/+</code></p>
<h2>Retained Messages</h2>
<p>Imagine a temperature sensor that sends the temperature every 10
minutes. This is a sensible intervall, since temperature does not change
too quickly, and the sensor should preserve its battery. When we start
an application that needs the temperature in a room, it would have to
wait until the sensor sends its temperature, which can be as long as
about 10 minutes in the worst case.</p>

<div class="figure">
<img src="../../pages/unit-7-comm/figures/mqtt-retained-1.svg" alt="Scenario without retained message: The subscriber misses the last update and has to wait until the next update is published." width="100%"/>
<span name="../../pages/unit-7-comm/figures/mqtt-retained-1.svg">&nbsp;</span>
<aside name="../../pages/unit-7-comm/figures/mqtt-retained-1.svg"><p><p>Scenario without retained message: The subscriber misses the last update and has to wait until the next update is published.</p>
</p></aside>
</div>
<p>Instead, the sensor can mark its temperature message as a <strong>retained</strong>
message. The broker will then store a copy of this message until it is
replaced with a new message sent to the same topic. Whenever a new
subscriber subscribes to the topic, it will immediately receive the
retained message from the broker. In our example this means that the
application does not have to wait until the sensor wakes up and sends
again, but that it immediately receives the last temperature reading.
(We show the reainted message with a trailing <em>R</em>.)</p>

<div class="figure">
<img src="../../pages/unit-7-comm/figures/mqtt-retained-2.svg" alt="Scenario with retained message: The subscriber misses the last update, but receives the retained message from the broker." width="100%"/>
<span name="../../pages/unit-7-comm/figures/mqtt-retained-2.svg">&nbsp;</span>
<aside name="../../pages/unit-7-comm/figures/mqtt-retained-2.svg"><p><p>Scenario with retained message: The subscriber misses the last update, but receives the retained message from the broker.</p>
</p></aside>
</div>
<h2>Last Wills</h2>
<p>The MQTT broker monitors the connection to all clients, and detects once
they do not respond anymore. Any subscriber, however, by default does
not get notified once another client disappears. For instance, our
temperature application would not be able to detect immediately once a
temperature sensor disconnects. (It would only indirectly, because there
would be no temperature readings anymore.)</p>
<p>Instead, a client can define a &quot;last will&quot; with the broker at the
connection startup. This last will defines a message payload and a topic
to which the message will be sent if the broker detects that the client
suddenly disconnects. Any interested subscribers can then get notified
about the sudden disconnection. If the client, however, disconnects
properly from the broker, the last will message is not sent.</p>
<h2>Quality of Service</h2>
<p>Messages can be sent with three different quality-of-service (QoS)
flags, which determine how much effort the broker and the clients spend
on sending them:</p>
<ul>
<li>
<p>QoS=0 is also called <em>At most once</em>. The message can get lost, and
there will be no attempts to resend it.</p>
</li>
<li>
<p>QoS=1 is also called <em>At least once</em>. This means that the message
will be eventually received, but that several copies of the message
may appear due to duplication. The receiver has to detect any such
duplicates.</p>
</li>
<li>
<p>QoS=2 is also called <em>Exactly once</em>. This guarantees the delivery
and avoids any duplication.</p>
</li>
</ul>
<p>You may immediately ask: <em>If QoS=2 is available, why would one ever use
any of the lower QoS levels?</em> The answer is that the highest quality of
service is also more expensive with regards to transmission effort. To
send a single QoS=2 message, several messages on the underlying channel
are necessary. Therefore, an application should always choose the lowest
QoS level it can work with. Below you see three diagrams that show how
many control packages are involved to just send a single MQTT message
with the different QoS levels. (The grey message arrows that start end end at the same lifeline illustrate only local operations, not communication.)</p>

<div class="figure">
<img src="../../pages/unit-7-comm/figures/mqtt-qos-0.svg" alt="To send one MQTT message with QoS 0, only two messages on the lower layer are necessary." width="100%"/>
<span name="../../pages/unit-7-comm/figures/mqtt-qos-0.svg">&nbsp;</span>
<aside name="../../pages/unit-7-comm/figures/mqtt-qos-0.svg"><p><p>To send one MQTT message with QoS 0, only two messages on the lower layer are necessary.</p>
</p></aside>
</div>
<div class="figure">
<img src="../../pages/unit-7-comm/figures/mqtt-qos-1.svg" alt="To send one MQTT message with QoS 1, at least three messages on the lower layer are necessary." width="100%"/>
<span name="../../pages/unit-7-comm/figures/mqtt-qos-1.svg">&nbsp;</span>
<aside name="../../pages/unit-7-comm/figures/mqtt-qos-1.svg"><p><p>To send one MQTT message with QoS 1, at least three messages on the lower layer are necessary.</p>
</p></aside>
</div>
<div class="figure">
<img src="../../pages/unit-7-comm/figures/mqtt-qos-2.svg" alt="To send one MQTT message with QoS 2, at least five messages on the lower layer are necessary." width="100%"/>
<span name="../../pages/unit-7-comm/figures/mqtt-qos-2.svg">&nbsp;</span>
<aside name="../../pages/unit-7-comm/figures/mqtt-qos-2.svg"><p><p>To send one MQTT message with QoS 2, at least five messages on the lower layer are necessary.</p>
</p></aside>
</div>
<h2>Sequence Diagrams on Many Levels</h2>
<p>Maybe you wondered how some of the sequence diagrams we have seen on the
last pages relate to those that you develop for a specific application.
Assume the application uses MQTT. What should you show then in a
sequence diagram? The answer: <em>It depends on what you want to show.</em></p>
<ul>
<li>
<p>The diagrams <strong>Quality of Service X</strong> above show how MQTT is implemented internally
and passes messages in order to publish one single message. These
diagrams are only interesting when you need to understand if the
MQTT protocol is suitable for your purposes, or you are concerned
which QoS level to use. You will probably not use this level of
detail for an application-level diagram.</p>
</li>
<li>
<p>The diagram above that shows MQTT using a retained message above
is already closer to the application level, since <em>publish</em>,
<em>subscribe</em> and <em>message</em> are shown as single, compact messages.</p>
</li>
<li>
<p>In some cases, it is probably interesting to show an MQTT broker as
part of the sequence diagram. After all, it is a critical component
in the system that requires consideration. But it may not be
necessary to contain the broker in the diagrams of all use cases.
Instead, the lifelines representing individual MQTT clients can
directly send messages to each other, so that the application logic
gets easier visible.</p>
</li>
</ul>

    </section>
    <section class="content">
<h1>Solution</h1>
<pre><code>   **Topic**                **Receive?**
</code></pre>
<hr />
<p>1    <code>#</code>                      yes
2    <code>+/+/+</code>                  no!
3    <code>+/+/+/+</code>                yes
4    <code>+/b/c/#</code>                yes
5    <code>+/b/c/d</code>                yes
6    <code>a/#</code>                    yes
7    <code>a/+/+/d</code>                yes
8    <code>a/+/c/d</code>                yes
9    <code>a/b/#</code>                  yes
10   <code>a/b/c</code>                  no!
11   <code>a/b/c/#</code>                yes
12   <code>a/b/c/d/#</code>              yes
13   <code>a/b/c/d</code>                yes
14   <code>b/+/c/d</code>                no!
15   <code>a/b/c/d/+</code>              no!</p>

    </section>
</div>
      </div>




    </div>

  </main>
<nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #7d705a">
    <div class="container-fluid">
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="https://www.ntnu.no/informasjonskapsler">Om informasjonskapsler</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://www.ntnu.no/personvern">Personvern</a>
          </li>
        </ul>
        <div class="bg-light ms-auto border-0"></div>
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/falkr/ttm4115/tree/master/pages/unit-7-comm/preparation-2.md">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
              </svg> Edit this page
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <script>
    anchors.add('h1').add('h2').add('h3');
    anchors.options.visible = 'always';
  </script>
  <script>
    















  </script>
</body>

</html>